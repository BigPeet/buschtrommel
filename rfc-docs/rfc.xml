<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<!-- vim: set noexpandtab : -->
<rfc ipr="none">
	<front>
        <title>Buschtrommel</title>
        <author />
		<date />
		<area>Applications</area>
		<workgroup>Telematics project 12/13</workgroup>
		<abstract>
			<t>This document is a draft for the official specification of the Buschtrommel protocol. Buschtrommel is used to find and transfer files between clients in the same network domain without the need for a central server.</t>
		</abstract>
	</front>
	<middle>
		<section title="Introduction">
			<t>This document specifies the Buschtrommel protocol, which is used for ad-hoc file transfer between peers in the same network domain.</t>
			<t>This specificiation defines package formats and required client behavior to enable such file transfers between conforming, well-behaved clients.</t>
			<t>This document describes the mechanisms required for completion of the following tasks:
				<list style="symbols">
					<t>peer and file announcement</t>
					<t>file transfer</t>
				</list>
			</t>
			<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</t>
		</section>

		<section title="High Level Overview">
			<t>
				Buschtrommel is focused on scenarios, where clients (a.k.a peers) do not share files for a long time. Files are announced in a short-termed fashion. Clients will not be connected for more than a few hours. The fast announcement of new clients and files is one of the main focuses.
			</t>
			<t>The protocol features can be roughly split into two groups:
				<list style="symbols">
					<t>announcement of peers and files</t>
					<t>file transfers</t>
				</list>
			</t>
			<t>
				Announcement features are implemented on top of UPD and multicast groups.
				File transfers and initial file annoucements use TCP peer-to-peer connections.
			</t>
		</section>

        <section title="General Notes">
            <t>
                Buschtrommel uses the following multicast addresses to address all participating peers:
                <list style="symbols">
                    <t>239.255.0.113 for IPv4</t>
                    <t>ff02::7171 for IPv6</t>
                </list>
                Clients have to listen on UDP Port XXX in order to participate in the network
                
                    Messages are encoded as UTF-8 strings and contain of multiple fields. | represents a field seperator and is encoded with the ascii control character 31 (unit seperator)
                    || represents an entry seperator and is encoded with the ascii control character 30 (record seperator) //TODO reference to rfc
                    Integers are represented as UTF-8 integegers as well.
                    Hashes are represented as UTF-8 hex string.
                
            </t>
        </section>

        <section title="Host Availability Announcement">
            <t>
                Hi Messages
                Jo Messages
            </t>
		</section>

        <section title="Filelists">
            <t>
                Format: Hash | TTL | Length | Virtual-Path | Meta ||
                TTL in seconds
                VirtualPath uses / as path seperator only
                Meta can be any text
                One FileList entry must not exceed the length of 512 Bytes
            </t>
            <t>
                Transfered via TCP. Requested via FileRequest message: ...
            </t>
        </section>

		<section title="File Solicitation">
            <t>
                File Solicitations are sent via UDP multicast and repesent updates of a filelist.
                One UDP datagram contains exactly one file solicitation.
			</t>
		</section>

		<section title="File Transfer">
			<t>
				To request a file an client opens a new TCP Connection to the remote peer. Called FILEREQ.
                Clients connects to the port, that was sent in the Hi message of the Host.
                Format: Hash, Offset, Length
			</t>
			<t>
                Server sends Reply: Status Code | ExpectedTransferVolume ||
                ExpectedTransfercolume is the amount of bytes, that will follow.
                Status Codes are "ok", "try again, later", try again, never" //TODO find good names
            </t>
		</section>
	</middle>

	<back>

		<references>
			<reference anchor="refs.RFC768">
				<front>
					<title>User Datagram Protocol</title>
					<author initials="J." surname="Postel" fullname="Jon Postel">
						<organization abbrev="ISI">USC/Information Sciences Institute</organization>
					</author>
					<date month="August" year="1980" />
				</front>
				<seriesInfo name="RFC" value="768" />
				<seriesInfo name="STD" value="6" />
			</reference>
			<reference anchor="refs.RFC793">
				<front>
					<title>Transmission Control Protocol</title>
					<author initials="J." surname="Postel" fullname="Jon Postel">
						<organization abbrev="ISI">USC/Information Sciences Institute</organization>
					</author>
					<date month="September" year="1981" />
				</front>
				<seriesInfo name="RFC" value="793" />
				<seriesInfo name="STD" value="7" />
			</reference>
			<reference anchor="refs.RFC791">
				<front>
					<title>Internet Protocol</title>
					<author initials="J." surname="Postel" fullname="Jon Postel">
						<organization abbrev="ISI">USC/Information Sciences Institute</organization>
					</author>
					<date month="September" year="1981" />
				</front>
				<seriesInfo name="RFC" value="791" />
				<seriesInfo name="STD" value="5" />
            </reference>
            <reference anchor="refs.RFC20">
                <front>
                    <title>ASCII format for network interchange</title>
                    <author initials="C." surname="Cerf" fullname="Vint Cerf">
                        <organization abbrev="UCLA">UCLA</organization>
                    </author>
                    <date month="October" year="1969" />
                </front>
                <seriesInfo name="RFC" value="20" />
            </reference>
        </references>

        <section title="Glossar">
            <t>
                <list>
				    <t>Peer - a client in general </t>
    				<t>Host - an client, which offers a file to others</t>
                </list>
            </t>
		</section>
	</back>
</rfc>
